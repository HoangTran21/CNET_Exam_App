<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CNET Exam Web</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-1: #f2f6ff;
      --bg-2: #e7f7f4;
      --ink: #0f172a;
      --muted: #4b5563;
      --brand: #0ea5a4;
      --brand-2: #22c55e;
      --card: #ffffff;
      --danger: #ef4444;
      --shadow: 0 18px 50px rgba(15, 23, 42, 0.12);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Space Grotesk", system-ui, sans-serif;
      color: var(--ink);
      background: radial-gradient(1200px 600px at 10% 0%, #ffffff 0%, var(--bg-1) 45%, var(--bg-2) 100%);
      min-height: 100vh;
    }

    .noise {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.06;
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2'/></filter><rect width='120' height='120' filter='url(%23n)'/></svg>");
      mix-blend-mode: multiply;
    }

    header {
      padding: 32px 20px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: clamp(28px, 4vw, 44px);
      letter-spacing: -0.02em;
    }

    header p {
      margin: 0;
      color: var(--muted);
      max-width: 720px;
      font-size: 16px;
    }

    .layout {
      width: min(1100px, 92vw);
      margin: 0 auto 80px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .card {
      background: var(--card);
      border-radius: 24px;
      padding: 22px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(15, 23, 42, 0.05);
      animation: floatIn 700ms ease both;
    }

    @keyframes floatIn {
      from { opacity: 0; transform: translateY(18px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .grid {
      display: grid;
      gap: 16px;
    }

    .grid.two {
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }

    label {
      font-weight: 600;
      font-size: 14px;
      color: var(--muted);
      display: block;
      margin-bottom: 8px;
    }

    input, select, textarea, button {
      font: inherit;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(15, 23, 42, 0.12);
      background: #fff;
      transition: border-color 150ms ease, box-shadow 150ms ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(14, 165, 164, 0.15);
    }

    button {
      cursor: pointer;
      border: none;
      border-radius: 999px;
      padding: 12px 20px;
      font-weight: 700;
      background: linear-gradient(120deg, var(--brand), var(--brand-2));
      color: white;
      transition: transform 120ms ease, filter 120ms ease;
    }

    button:hover { transform: translateY(-1px); filter: brightness(1.05); }
    button:active { transform: translateY(0); }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(14, 165, 164, 0.1);
      color: var(--brand);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 700;
    }

    .quiz-meta {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .timer {
      font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, monospace;
      font-weight: 600;
      color: var(--ink);
    }

    .question {
      padding: 16px;
      border-radius: 16px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      background: #f8fafc;
    }

    .question h3 {
      margin: 0 0 10px;
      font-size: 16px;
    }

    .options {
      display: grid;
      gap: 8px;
    }

    .option {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      background: #fff;
      transition: border-color 120ms ease, background 120ms ease;
    }

    .option.correct { border-color: rgba(34, 197, 94, 0.7); background: rgba(34, 197, 94, 0.08); }
    .option.wrong { border-color: rgba(239, 68, 68, 0.7); background: rgba(239, 68, 68, 0.08); }

    .option input {
      margin-top: 3px;
    }

    .coding {
      font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, monospace;
      min-height: 120px;
    }

    .result {
      display: none;
      padding: 16px;
      border-radius: 16px;
      background: #0f172a;
      color: #e2e8f0;
    }

    .result strong { color: #fff; }

    .footer {
      text-align: center;
      color: var(--muted);
      font-size: 12px;
      margin-top: 20px;
    }

    @media (min-width: 860px) {
      .layout { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="noise"></div>
  <header>
    <span class="pill">CNET Exam Web</span>
    <h1>Quiz Python tren GitHub Pages</h1>
    <p>Ban dang xem ban web tinh tu du lieu JSON. Chon de thi, dien ten, sau do lam bai truc tuyen.</p>
  </header>

  <main class="layout">
    <section class="card" id="setup-card">
      <div class="grid two">
        <div>
          <label for="student-name">Ho va ten</label>
          <input id="student-name" type="text" placeholder="Nhap ho ten" />
        </div>
        <div>
          <label for="quiz-select">Chon de thi</label>
          <select id="quiz-select"></select>
        </div>
      </div>
      <div style="margin-top: 16px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
        <button id="start-btn">Bat dau</button>
        <span class="pill" id="quiz-info">Chua co de thi</span>
      </div>
    </section>

    <section class="card" id="quiz-card" style="display: none;">
      <div class="quiz-meta">
        <span class="pill" id="quiz-title"></span>
        <span class="timer" id="timer">00:00</span>
      </div>
      <div class="grid" id="questions"></div>

      <div class="grid" style="margin-top: 18px;">
        <label for="coding-area">Bai tap code (tu luan)</label>
        <textarea id="coding-area" class="coding" placeholder="Nhap bai lam o day..."></textarea>
      </div>

      <div style="margin-top: 18px; display: flex; gap: 12px; flex-wrap: wrap;">
        <button id="submit-btn">Nop bai</button>
        <button id="reset-btn" type="button" style="background: #0f172a;">Lam lai</button>
      </div>

      <div class="result" id="result-box" style="margin-top: 16px;"></div>
    </section>
  </main>

  <div class="footer">Du lieu lay tu thu muc data/ trong repo. Phu hop cho GitHub Pages.</div>

  <script>
    const quizFiles = [
      { label: "Module 1", file: "data/module1.json" },
      { label: "Module 2", file: "data/module2.json" },
      { label: "Map Zip De quy", file: "data/Map_zip_enumerate_Đệ quy.json" }
    ];

    const quizSelect = document.getElementById("quiz-select");
    const quizInfo = document.getElementById("quiz-info");
    const startBtn = document.getElementById("start-btn");
    const quizCard = document.getElementById("quiz-card");
    const setupCard = document.getElementById("setup-card");
    const quizTitle = document.getElementById("quiz-title");
    const timerEl = document.getElementById("timer");
    const questionsEl = document.getElementById("questions");
    const submitBtn = document.getElementById("submit-btn");
    const resetBtn = document.getElementById("reset-btn");
    const resultBox = document.getElementById("result-box");
    const codingArea = document.getElementById("coding-area");

    let currentQuiz = null;
    let countdownId = null;
    let timeLeft = 0;

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60).toString().padStart(2, "0");
      const s = Math.floor(seconds % 60).toString().padStart(2, "0");
      return `${m}:${s}`;
    }

    function setTimer(seconds) {
      timeLeft = seconds;
      timerEl.textContent = formatTime(timeLeft);
      if (countdownId) clearInterval(countdownId);
      countdownId = setInterval(() => {
        timeLeft -= 1;
        if (timeLeft <= 0) {
          timeLeft = 0;
          clearInterval(countdownId);
          handleSubmit();
        }
        timerEl.textContent = formatTime(timeLeft);
      }, 1000);
    }

    function clearQuestions() {
      questionsEl.innerHTML = "";
    }

    function buildQuestions(questions) {
      clearQuestions();
      questions.forEach((item, idx) => {
        const wrapper = document.createElement("div");
        wrapper.className = "question";
        wrapper.dataset.index = idx;

        const title = document.createElement("h3");
        title.textContent = `${idx + 1}. ${item.q}`;
        wrapper.appendChild(title);

        const options = document.createElement("div");
        options.className = "options";

        item.opts.forEach((opt, optIdx) => {
          const label = document.createElement("label");
          label.className = "option";

          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = `q${idx}`;
          radio.value = optIdx;

          const text = document.createElement("span");
          text.textContent = opt;

          label.appendChild(radio);
          label.appendChild(text);
          options.appendChild(label);
        });

        wrapper.appendChild(options);
        questionsEl.appendChild(wrapper);
      });
    }

    function setQuizInfo(data) {
      quizInfo.textContent = `${data.title} · ${data.questions.length} cau`;
    }

    function normalizeCodingTasks(data) {
      if (Array.isArray(data.coding_tasks)) return data.coding_tasks;
      if (typeof data.coding_task === "string") return [data.coding_task];
      return [];
    }

    function renderCodingTasks(tasks) {
      if (!tasks.length) {
        codingArea.placeholder = "Khong co bai tap code cho de nay.";
        return;
      }
      codingArea.placeholder = tasks.map((t, i) => `${i + 1}. ${t}`).join("\n");
    }

    async function loadQuiz(file) {
      const response = await fetch(file);
      if (!response.ok) throw new Error("Khong the tai de thi");
      return response.json();
    }

    function buildSelect() {
      quizSelect.innerHTML = "";
      quizFiles.forEach((quiz) => {
        const opt = document.createElement("option");
        opt.value = quiz.file;
        opt.textContent = quiz.label;
        quizSelect.appendChild(opt);
      });
    }

    async function handleStart() {
      const file = quizSelect.value;
      if (!file) return;

      try {
        currentQuiz = await loadQuiz(file);
        setQuizInfo(currentQuiz);
        quizTitle.textContent = currentQuiz.title;
        buildQuestions(currentQuiz.questions || []);
        renderCodingTasks(normalizeCodingTasks(currentQuiz));
        setTimer(currentQuiz.time_seconds || 900);
        resultBox.style.display = "none";
        resultBox.textContent = "";
        setupCard.style.display = "none";
        quizCard.style.display = "block";
      } catch (err) {
        alert(err.message || "Co loi xay ra");
      }
    }

    function handleSubmit() {
      if (!currentQuiz) return;
      const answers = Array.from(questionsEl.querySelectorAll(".question"));
      let correct = 0;
      answers.forEach((qEl, idx) => {
        const selected = qEl.querySelector("input[type=radio]:checked");
        const correctIdx = currentQuiz.questions[idx].ans;
        const optionEls = qEl.querySelectorAll(".option");
        optionEls.forEach((optEl, optIdx) => {
          optEl.classList.remove("correct", "wrong");
          if (optIdx === correctIdx) optEl.classList.add("correct");
        });
        if (selected && Number(selected.value) === correctIdx) {
          correct += 1;
        } else if (selected) {
          optionEls[Number(selected.value)]?.classList.add("wrong");
        }
      });

      const total = currentQuiz.questions.length;
      const name = document.getElementById("student-name").value.trim() || "Ban";
      resultBox.innerHTML = `<strong>${name}</strong>, ban dung ${correct}/${total} cau.`;
      resultBox.style.display = "block";
      if (countdownId) clearInterval(countdownId);
    }

    function handleReset() {
      quizCard.style.display = "none";
      setupCard.style.display = "block";
      clearQuestions();
      codingArea.value = "";
      currentQuiz = null;
      if (countdownId) clearInterval(countdownId);
      timerEl.textContent = "00:00";
    }

    startBtn.addEventListener("click", handleStart);
    submitBtn.addEventListener("click", handleSubmit);
    resetBtn.addEventListener("click", handleReset);

    buildSelect();
    quizSelect.addEventListener("change", async () => {
      const file = quizSelect.value;
      if (!file) return;
      try {
        const data = await loadQuiz(file);
        setQuizInfo(data);
      } catch {
        quizInfo.textContent = "Khong the doc de thi";
      }
    });

    if (quizFiles.length) {
      quizSelect.value = quizFiles[0].file;
      loadQuiz(quizFiles[0].file).then(setQuizInfo).catch(() => {
        quizInfo.textContent = "Khong the doc de thi";
      });
    }
  </script>
</body>
</html>
